{% extends "_base.html" %}
{% load static %}
{% load i18n %}

{% block page_title %}{{ doctor.user.get_full_name|default:doctor.user.username }}{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Doctor Profile -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="row g-0">
            <div class="col-md-3 text-center p-4">
                <img src="{% static 'images/doctor-avatar.png' %}" class="rounded-circle img-fluid" alt="Doctor">
            </div>
            <div class="col-md-9">
                <div class="card-body">
                    <h3 class="fw-bold text-primary">Dr. {{ doctor.user.get_full_name|default:doctor.user.username }}</h3>
                    <h6 class="text-muted">{{ doctor.specialty.name }}</h6>
                    <p class="mt-3">{{ doctor.biography }}</p>
                    <p><i class="bi bi-geo-alt-fill text-danger"></i> {{ doctor.office_address }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Appointment Form -->
        <div class="col-lg-6">
            {% if user.is_authenticated and user != doctor.user %}
                <div class="card shadow-sm border-0">
                    <div class="card-body">
                        <h4 class="fw-bold mb-3">{% trans "Book an Appointment" %}</h4>

                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} mb-3">{{ message }}</div>
                            {% endfor %}
                        {% endif %}

                        <!-- FIXED: form action points to doctor_detail view -->
                        <form method="post" action="{% url 'appointments:doctor_detail' pk=doctor.pk %}">
                            {% csrf_token %}
                            {{ appointment_form.non_field_errors }}
                            <div class="mb-3">
                                {{ appointment_form.date.label_tag }}
                                {{ appointment_form.date }}
                                {{ appointment_form.date.errors }}
                            </div>
                            <div class="mb-3">
                                {{ appointment_form.time.label_tag }}
                                {{ appointment_form.time }}
                                {{ appointment_form.time.errors }}
                            </div>
                            <div class="mb-3">
                                {{ appointment_form.description.label_tag }}
                                {{ appointment_form.description }}
                                {{ appointment_form.description.errors }}
                            </div>
                            <div class="mb-3">
                            {{ appointment_form.status.label_tag }}
                            {{ appointment_form.status }}
                            {{ appointment_form.status.errors }}
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-calendar-plus"></i> {% trans "Book" %}
                            </button>
                        </form>
                    </div>
                </div>
            {% elif not user.is_authenticated %}
                <!-- FIXED: simpler login message without blocktrans issues -->
                <div class="alert alert-info">
                    {% trans "You must be" %} 
                    <a href="{% url 'account_login' %}" class="fw-bold">{% trans "logged in" %}</a> 
                    {% trans "to book an appointment." %}
                </div>
            {% endif %}
        </div>

        <!-- Placeholder for extra content -->
        <div class="col-lg-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="fw-bold">{% trans "Additional Information" %}</h5>
                    <p class="text-muted">{% trans "This section can show the doctor's working hours, reviews, or other details." %}</p>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}
